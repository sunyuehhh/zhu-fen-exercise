{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { NodeTypes } from './ast'\n\nfunction createParserContext(template){\n\n  return {\n    line:1,//\u884C\u53F7\n    column:1,//\u5217\u53F7\n    offset:0,//\u504F\u79FB\u91CF\n    source:template,//\u4F1A\u4E0D\u505C\u5F97\u622A\u53D6  \u77E5\u9053\u5B57\u7B26\u4E32\u4E3A\u7A7A\u5F97\u65F6\u5019\n    originalSource:template\n  }\n\n}\n\n// \u5FAA\u73AF\u904D\u5386\u6A21\u677F\u5F97\u7EC8\u6B62\u6761\u4EF6 \u5982\u679C\u4E3A\u7A7A\u8BF4\u660E\u904D\u5386\u5B8C\u6BD5\nfunction isEnd(context){\n  if(context.source.startsWith('</')){\n    return true\n  }\n  const source=context.source\n\n  \n  return !source\n\n}\n\n\nfunction getSelection(context,start,end?){\n  end=getCursor(context)\n\n  return {\n    start,\n    end,\n    source:context.originalSource.slice(start.offset,end.offset)\n  }\n\n}\n\n\n\nfunction getCursor(context){\n  let {line,column,offset}=context\n  return {\n    line,\n    column,\n    offset\n  }\n}\n\n\nfunction advanceBy(context,endIndex){\n  let source=context.source\n\n  // \u5220\u9664\u89E3\u6790\u540E\u5F97\u5185\u5BB9\n  context.source=source.slice(endIndex)\n\n}\n\n\nfunction advancePositionWithMutation(context,source,endIndex){\n  let linesCount=0;//\u8BA1\u7B97\u7ECF\u8FC7\u591A\u5C11\u884C \\n\n  let linePos=-1;//\u9047\u5230\u6362\u884C\u6807\u8BB0\u6362\u884C\u5F97\u5F00\u59CB\u4F4D\u7F6E\n\n  // \u6839\u636E\u7ED3\u675F\u7D22\u5F15\u904D\u5386\u5185\u5BB9  \u770B\u4E00\u4E0B\u7ECF\u5386\u4E86\u591A\u5C11\u4E2A\\n\u5B57\u7B26\n  for(let i=0;i<endIndex;i++){\n    if(source[i]?.charCodeAt(0)===10){\n      // \u5C31\u662F\u6362\u884C\n      linesCount++;\n      linePos=i\n    }\n  }\n\n  context.line+=linesCount\n  context.offset+=endIndex\n\n  context.column=linePos==-1?context.column+endIndex:endIndex-linePos\n  \n\n}\n\n\nfunction parserTextData(context,endIndex){\n  const content=context.source.slice(0,endIndex)\n\n  //\u622A\u53D6\u540E\u9700\u8981\u5C06context.\u4E2D\u5F97\u5185\u5BB9\u5220\u9664\u6389  \u5220\u9664\u5DF2\u7ECF\u89E3\u6790\u5F97\u5185\u5BB9\n  advanceBy(context,endIndex) \n\n  let source=context.source\n\n  advancePositionWithMutation(context,source,endIndex)\n\n\n\n  return content\n}\n\nfunction parserText(context){\n  // \u5982\u4F55\u8BA1\u7B97\u6587\u672C\u5F97\u7ED3\u675F\u4F4D\u7F6E\n  // \u5047\u8BBE\u6C42\u672B\u5C3E\u5F97\u7D22\u5F15  \u5F97\u5230\u8DDD\u79BB\u81EA\u5DF1\u6700\u8FD1\u5F97< \u6216\u8005{{ \u5C31\u7ED3\u675F\u54A7\n  let endTokens=['<',\"{{\"]\n  let endIndex=context.source.length;//\u9ED8\u8BA4\u672B\u5C3E\u5C31\u662F\u6700\u540E\u4E00\u4F4D\n\n\n  let start=getCursor(context)\n\n  // \n  for(let i=0;i<endTokens.length;i++){\n    // \u56E0\u4E3A\u5F00\u5934\u80AF\u5B9A\u662F\u6587\u672C \u6240\u4EE5\u7B2C\u4E00\u4E2A\u5B57\u7B26\u80AF\u5B9A\u4E0D\u662F< {{  \u4ECE\u4E0B\u4E00\u4E2A\u5F00\u59CB\u67E5\u627E\n    const index=context.source.indexOf(endTokens[i],1)\n    if(index>-1&&index<endIndex){\n      // \u6CA1\u5230\u7ED3\u5C3E\u5C31\u9047\u5230\u4E86{{   <\n      endIndex=index;//\u7528\u6700\u8FD1\u5F97\u4F5C\u4E3A\u6211\u4EEC\u7684\u7ED3\u5C3E\n    }\n  }\n  \n\n  const content=parserTextData(context,endIndex)\n\n  // let end=getCursor(context)\n\n  return {\n    type:NodeTypes.TEXT,\n    content,\n    loc:getSelection(context,start)\n  }\n\n}\n\nfunction parserInterpolation(context){\n  const start=getCursor(context);//\u8868\u8FBE\u5F0F\u5F97\u5F00\u59CB\u4FE1\u606F\n\n  const clonseIndex=context.source.indexOf(\"}}\",2)\n\n  advanceBy(context,2)\n\n  const innerStart=getCursor(context)\n\n  const rawContentEndIndex=clonseIndex-2;//\u83B7\u53D6\u539F\u59CB\u7528\u6237\u5927\u62EC\u53F7\u4E2D\u5F97\u5185\u5BB9\n  const preTrimContent=parserTextData(context,rawContentEndIndex)\n\n  const innerEnd=getCursor(context)\n\n  const content=preTrimContent.trim();//\u53BB\u6389\u5185\u5BB9\u5F97\u7A7A\u683C\n  advanceBy(context,2);//\u53BB\u6389  }}\n\n  return {\n    type:NodeTypes.INTERPOLATION,\n    content:{\n      type:NodeTypes.SIMPLE_EXPRESSION,\n      isStatic:false,\n      content:content,\n      loc:getSelection(context,innerStart,innerEnd)\n    },\n    loc:getSelection(context,start)\n  }\n\n}\n\nfunction advanceBySpaces(context){\n  const match=/^[ \\t\\r\\n]+/.exec(context.source)\n  if(match){\n    advanceBy(context,match[0].length);//\u5220\u9664\u6240\u6709\u7A7A\u683C\n\n  }\n\n}\n\n\nfunction parseAttributeValue(context){\n  // \u5982\u679C\u6709\u5F15\u53F7  \u5220\u9664\u5F15\u53F7  \u6CA1\u6709\u5F15\u53F7  \u53EF\u4EE5\u76F4\u63A5\u7528\n  const quate=context.source[0]\n  const isQuoted=quate===\"'\"||quate==='\"'\n  let content;\n  if(isQuoted){\n    advanceBy(context,1)\n    const endIndex=context.source.indexOf(quate)\n    content=parserTextData(context,endIndex)\n\n    advanceBy(context,1)\n    return content\n  }else{\n\n  }\n\n}\n\nfunction parseAttribute(context){\n  const start=getCursor(context);\n\nconst match = /^[^\\t\\r\\n\\f />][^\\t\\r\\n\\f />=]*/.exec(context.source);\n\nconst name = match[0]; // \u83B7\u53D6\u5C5E\u6027\u540D\u5B57\n\nadvanceBy(context, name.length); // \u5220\u9664\u5C5E\u6027\u540D\n\nlet value;\n\n// \u5148\u5339\u914D\u7A7A\u683C \u548C = \u5220\u9664\u6389 \u540E\u9762\u7684\u5C31\u662F\u6570\u503C\nif (/^[\\t\\r\\n\\f ]*=/ .test(context.source)) {\n  // = b\n  advanceBySpaces(context);\n  advanceBy(context, 1);\n  advanceBySpaces(context);\n  value = parseAttributeValue(context); // b\n}\n\nreturn {\n  type:NodeTypes.ATTRIBUTE,\n  name,\n  value:{\n    content:value\n  },\n  toc:getSelection(context,start)\n}\n}\n\nfunction parseChildrenAttribute(context){\n  // \u89E3\u6790\u5C5E\u6027\n  const props=[];\n\n  while(!context.source.startsWith(\">\")){\n    // \u9047\u5230  >\u5C31\u505C\u6B62\u5FAA\u73AF\n    const prop=parseAttribute(context)\n    props.push(prop)\n\n  }\n  \n\n  return props\n\n}\n\n\nfunction parserTag(context){\n  const start = getCursor(context);\n\n  const match = /^<\\/?([a-z][^\\t\\r\\n />]*)/i.exec(context.source);\n\n  const tag = match[1]; // 'div'\n\n  advanceBy(context, match[0].length); // <div\n  advanceBySpaces(context)\n\n  // \u5904\u7406\u5143\u7D20\u4E0A\u7684\u5C5E\u6027\n  let props=parseChildrenAttribute(context);\n\n  let isSelfClosing=context.source.startsWith(\"/>\");//\u6211\u9700\u8981\u5220\u9664\u95ED\u5408\u6807\u7B7E\n\n  advanceBy(context,isSelfClosing?2:1)\n\n\n  return {\n    tag,\n    props,\n    type:NodeTypes.ELEMENT,\n    isSelfClosing,\n    loc:getSelection(context,start)\n  }\n\n}\n\nfunction parserChildren(context){\n\n  const nodes=[]\n\n  while(!isEnd(context)){\n    const s=context.source;//\u83B7\u53D6\u5F53\u524D\u5F97\u5185\u5BB9\n\n    let node;//\u5F53\u524D\u5904\u7406\u5F97\u8282\u70B9\n    if(s[0]==='<'){\n      // \u6211\u53EF\u4EE5\u5BF9\u5143\u7D20\u8FDB\u884C\u5904\u7406\n      node=parserTag(context)\n\n      if(context.source.startsWith('/>')){ //<div \n        parserTag(context);//\u5220\u9664\u6807\u7B7E\u7684\u95ED\u5408\u6807\u7B7E  \u6CA1\u6709\u6536\u96C6\n\n      }\n\n      node.loc=getSelection(context,node.loc.start)\n    }else if(s.startsWith(\"{{\")){\n      // \u6211\u4EEC\u53EF\u4EE5\u5BF9\u8868\u8FBE\u5F0F\u8FDB\u884C\u5904\u7406\n      node=parserInterpolation(context)\n    }\n\n    if(!node){\n      // \u8FD9\u4E2A\u4E1C\u897F\u5C31\u662F\u6587\u672C\n      node=parserText(context)\n    }\n\n    nodes.push(node)\n  }\n\n\n  return nodes\n\n}\n\nfunction parser(template){\n  // \u89E3\u6790\u7684\u65F6\u5019   \u89E3\u6790\u4E00\u70B9  \u5220\u9664\u4E00\u70B9\u513F  \u89E3\u6790\u7684\u7EC8\u6B62\u6761\u4EF6\u662F\u6A21\u677F\u7684\u5185\u5BB9\u6700\u7EC8\u4E3A\u7A7A\n  // \u72B6\u6001\u673A  \u6709\u9650\u72B6\u6001\u673A\n\n  const context=createParserContext(template)\n\n  const nodes=parserChildren(context)\n\n\n  console.log(nodes,'nodes')\n\n}\n\nexport function compile(template){\n  return parser(template)\n\n}"],
  "mappings": "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",
  "names": []
}

{"ast":null,"code":"var _jsxFileName = \"D:\\\\xuexishipin\\\\exercise\\\\zhu-fen-exercise\\\\react\\\\zhihu\\\\src\\\\views\\\\Login.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Form, Input, Toast } from 'antd-mobile';\nimport { connect } from 'react-redux';\nimport action from '../store/action';\nimport './Login.less';\nimport ButtonAgain from '../components/ButtonAgain';\nimport NavBarAgain from '../components/NavBarAgain';\nimport api from '../api';\nimport _ from '../assets/utils';\n\n/* 自定义表单校验规则 */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst validate = {\n  phone(_, value) {\n    value = value.trim();\n    let reg = /^(?:(?:\\+|00)86)?1\\d{10}$/;\n    if (value.length === 0) return Promise.reject(new Error('手机号是必填项!'));\n    if (!reg.test(value)) return Promise.reject(new Error('手机号格式有误!'));\n    return Promise.resolve();\n  },\n  code(_, value) {\n    value = value.trim();\n    let reg = /^\\d{6}$/;\n    if (value.length === 0) return Promise.reject(new Error('验证码是必填项!'));\n    if (!reg.test(value)) return Promise.reject(new Error('验证码格式有误!'));\n    return Promise.resolve();\n  }\n};\nconst Login = function Login(props) {\n  _s();\n  let {\n    queryUserInfoAsync,\n    navigate,\n    usp\n  } = props;\n\n  /* 状态 */\n  const [formIns] = Form.useForm(),\n    [disabled, setDisabled] = useState(false),\n    [sendText, setSendText] = useState('发送验证码');\n\n  /* 表单提交 */\n  const submit = async () => {\n    try {\n      await formIns.validateFields();\n      let {\n        phone,\n        code\n      } = formIns.getFieldsValue();\n      let {\n        code: codeHttp,\n        token\n      } = await api.login(phone, code);\n      if (+codeHttp !== 0) {\n        Toast.show({\n          icon: 'fail',\n          content: '登录失败'\n        });\n        formIns.resetFields(['code']);\n        return;\n      }\n      // 登录成功:存储Token、存储登录者信息到redux、提示、跳转\n      _.storage.set('tk', token);\n      await queryUserInfoAsync(); //派发任务,同步redux中的状态信息\n      Toast.show({\n        icon: 'success',\n        content: '登录/注册成功'\n      });\n      let to = usp.get('to');\n      to ? navigate(to, {\n        replace: true\n      }) : navigate(-1);\n    } catch (_) {}\n  };\n\n  /* 发送验证码 */\n  let timer = null,\n    num = 31;\n  const countdown = () => {\n    num--;\n    if (num === 0) {\n      clearInterval(timer);\n      timer = null;\n      setSendText(`发送验证码`);\n      setDisabled(false);\n      return;\n    }\n    setSendText(`${num}秒后重发`);\n  };\n  const send = async () => {\n    try {\n      await formIns.validateFields(['phone']);\n      let phone = formIns.getFieldValue('phone');\n      let {\n        code\n      } = await api.sendPhoneCode(phone);\n      if (+code !== 0) {\n        Toast.show({\n          icon: 'fail',\n          content: '发送失败'\n        });\n        return;\n      }\n      // 发送成功\n      setDisabled(true);\n      countdown();\n      if (!timer) timer = setInterval(countdown, 1000);\n    } catch (_) {}\n  };\n  // 组件销毁的时候:把没有清除的定时器干掉\n  useEffect(() => {\n    return () => {\n      if (timer) {\n        clearInterval(timer);\n        timer = null;\n      }\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"login-box\",\n    children: [/*#__PURE__*/_jsxDEV(NavBarAgain, {\n      title: \"\\u767B\\u5F55/\\u6CE8\\u518C\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      layout: \"horizontal\",\n      style: {\n        '--border-top': 'none'\n      },\n      footer: /*#__PURE__*/_jsxDEV(ButtonAgain, {\n        color: \"primary\",\n        onClick: submit,\n        children: \"\\u63D0\\u4EA4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }, this),\n      form: formIns,\n      initialValues: {\n        phone: '',\n        code: ''\n      },\n      children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"phone\",\n        label: \"\\u624B\\u673A\\u53F7\",\n        rules: [{\n          validator: validate.phone\n        }],\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u53F7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"code\",\n        label: \"\\u9A8C\\u8BC1\\u7801\",\n        rules: [{\n          validator: validate.code\n        }],\n        extra: /*#__PURE__*/_jsxDEV(ButtonAgain, {\n          size: \"small\",\n          color: \"primary\",\n          disabled: disabled,\n          onClick: send,\n          children: sendText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 21\n        }, this),\n        children: /*#__PURE__*/_jsxDEV(Input, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 12\n  }, this);\n};\n_s(Login, \"+2XFSpi20AzXyUyGNA67WHZinyw=\", false, function () {\n  return [Form.useForm];\n});\n_c = Login;\nexport default connect(null, action.base)(Login);\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useState","useEffect","Form","Input","Toast","connect","action","ButtonAgain","NavBarAgain","api","_","validate","phone","value","trim","reg","length","Promise","reject","Error","test","resolve","code","Login","props","queryUserInfoAsync","navigate","usp","formIns","useForm","disabled","setDisabled","sendText","setSendText","submit","validateFields","getFieldsValue","codeHttp","token","login","show","icon","content","resetFields","storage","set","to","get","replace","timer","num","countdown","clearInterval","send","getFieldValue","sendPhoneCode","setInterval","validator","base"],"sources":["D:/xuexishipin/exercise/zhu-fen-exercise/react/zhihu/src/views/Login.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Form, Input, Toast } from 'antd-mobile';\nimport { connect } from 'react-redux';\nimport action from '../store/action';\nimport './Login.less';\nimport ButtonAgain from '../components/ButtonAgain';\nimport NavBarAgain from '../components/NavBarAgain';\nimport api from '../api';\nimport _ from '../assets/utils';\n\n/* 自定义表单校验规则 */\nconst validate = {\n    phone(_, value) {\n        value = value.trim();\n        let reg = /^(?:(?:\\+|00)86)?1\\d{10}$/;\n        if (value.length === 0) return Promise.reject(new Error('手机号是必填项!'));\n        if (!reg.test(value)) return Promise.reject(new Error('手机号格式有误!'));\n        return Promise.resolve();\n    },\n    code(_, value) {\n        value = value.trim();\n        let reg = /^\\d{6}$/;\n        if (value.length === 0) return Promise.reject(new Error('验证码是必填项!'));\n        if (!reg.test(value)) return Promise.reject(new Error('验证码格式有误!'));\n        return Promise.resolve();\n    }\n};\n\nconst Login = function Login(props) {\n    let { queryUserInfoAsync, navigate, usp } = props;\n\n    /* 状态 */\n    const [formIns] = Form.useForm(),\n        [disabled, setDisabled] = useState(false),\n        [sendText, setSendText] = useState('发送验证码');\n\n    /* 表单提交 */\n    const submit = async () => {\n        try {\n            await formIns.validateFields();\n            let { phone, code } = formIns.getFieldsValue();\n            let { code: codeHttp, token } = await api.login(phone, code);\n            if (+codeHttp !== 0) {\n                Toast.show({\n                    icon: 'fail',\n                    content: '登录失败'\n                });\n                formIns.resetFields(['code']);\n                return;\n            }\n            // 登录成功:存储Token、存储登录者信息到redux、提示、跳转\n            _.storage.set('tk', token);\n            await queryUserInfoAsync(); //派发任务,同步redux中的状态信息\n            Toast.show({\n                icon: 'success',\n                content: '登录/注册成功'\n            });\n            let to = usp.get('to');\n            to ? navigate(to, { replace: true }) : navigate(-1);\n        } catch (_) { }\n    };\n\n    /* 发送验证码 */\n    let timer = null,\n        num = 31;\n    const countdown = () => {\n        num--;\n        if (num === 0) {\n            clearInterval(timer);\n            timer = null;\n            setSendText(`发送验证码`);\n            setDisabled(false);\n            return;\n        }\n        setSendText(`${num}秒后重发`);\n    };\n    const send = async () => {\n        try {\n            await formIns.validateFields(['phone']);\n            let phone = formIns.getFieldValue('phone');\n            let { code } = await api.sendPhoneCode(phone);\n            if (+code !== 0) {\n                Toast.show({\n                    icon: 'fail',\n                    content: '发送失败'\n                });\n                return;\n            }\n            // 发送成功\n            setDisabled(true);\n            countdown();\n            if (!timer) timer = setInterval(countdown, 1000);\n        } catch (_) { }\n    };\n    // 组件销毁的时候:把没有清除的定时器干掉\n    useEffect(() => {\n        return () => {\n            if (timer) {\n                clearInterval(timer);\n                timer = null;\n            }\n        }\n    }, []);\n\n    return <div className='login-box'>\n        <NavBarAgain title=\"登录/注册\" />\n        <Form\n            layout='horizontal'\n            style={{ '--border-top': 'none' }}\n            footer={\n                <ButtonAgain color='primary'\n                    onClick={submit}>\n                    提交\n                </ButtonAgain>\n            }\n            form={formIns}\n            initialValues={{ phone: '', code: '' }}\n        >\n            <Form.Item name='phone' label='手机号' rules={[{ validator: validate.phone }]}>\n                <Input placeholder='请输入手机号' />\n            </Form.Item>\n\n            <Form.Item name='code' label='验证码'\n                rules={[{ validator: validate.code }]}\n                extra={\n                    <ButtonAgain size='small' color='primary'\n                        disabled={disabled}\n                        onClick={send}>\n                        {sendText}\n                    </ButtonAgain>\n                }\n            >\n                <Input />\n            </Form.Item>\n        </Form>\n    </div>;\n};\nexport default connect(\n    null,\n    action.base\n)(Login);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"D:\\\\xuexishipin\\\\exercise\\\\zhu-fen-exercise\\\\react\\\\zhihu\\\\src\\\\views\\\\Update.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from \"react\";\nimport NavBarAgain from '../components/NavBarAgain';\nimport ButtonAgain from '../components/ButtonAgain';\nimport styled from \"styled-components\";\nimport { ImageUploader, Input, Toast } from 'antd-mobile';\nimport { connect } from 'react-redux';\nimport action from '../store/action';\nimport api from '../api';\n\n/* 样式 */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UpdateBox = styled.div`\n    .formBox {\n        padding: 0.4rem;\n\n        .item {\n            display: flex;\n            align-items: center;\n            height: 1.46667rem;\n            line-height: 1.46667rem;\n            font-size: 0.37333rem;\n\n            .label {\n                width: 20%;\n                text-align: center;\n            }\n\n            .input {\n                width: 80%;\n            }\n        }\n    }\n\n    .submit {\n        display: block;\n        margin: 0 auto;\n        width: 60%;\n        height: 0.93333rem;\n        font-size: 0.37333rem;\n    }\n`;\n_c = UpdateBox;\nconst Update = function Update(props) {\n  _s();\n  let {\n    info,\n    queryUserInfoAsync,\n    navigate\n  } = props;\n  /* 定义状态 */\n  let [pic, setPic] = useState([{\n      url: info.pic\n    }]),\n    [username, setUserName] = useState(info.name);\n\n  /* 图片上传 */\n  const limitImage = file => {\n    let limit = 1024 * 1024;\n    if (file.size > limit) {\n      Toast.show({\n        icon: 'fail',\n        content: '图片须在1MB内'\n      });\n      return null;\n    }\n    return file;\n  };\n  const uploadImage = async file => {\n    let temp;\n    try {\n      let {\n        code,\n        pic\n      } = await api.upload(file);\n      if (+code !== 0) {\n        Toast.show({\n          icon: 'fail',\n          content: '上传失败'\n        });\n        return;\n      }\n      temp = pic;\n      setPic([{\n        url: pic\n      }]);\n    } catch (_) {}\n    return {\n      url: temp\n    };\n  };\n\n  /* 提交信息 */\n  const submit = async () => {\n    // 表单校验\n    if (pic.length === 0) {\n      Toast.show({\n        icon: 'fail',\n        content: '请先上传图片'\n      });\n      return;\n    }\n    if (username.trim() === \"\") {\n      Toast.show({\n        icon: 'fail',\n        content: '请先输入账号'\n      });\n      return;\n    }\n    // 获取信息，发送请求\n    let [{\n      url\n    }] = pic;\n    try {\n      let {\n        code\n      } = await api.userUpdate(username.trim(), url);\n      if (+code !== 0) {\n        Toast.show({\n          icon: 'fail',\n          content: '修改信息失败'\n        });\n        return;\n      }\n      Toast.show({\n        icon: 'success',\n        content: '修改信息成功'\n      });\n      queryUserInfoAsync(); //同步redux中的信息\n      navigate(-1);\n    } catch (_) {}\n  };\n  return /*#__PURE__*/_jsxDEV(UpdateBox, {\n    children: [/*#__PURE__*/_jsxDEV(NavBarAgain, {\n      title: \"\\u4FEE\\u6539\\u4FE1\\u606F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"formBox\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"item\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"\\u5934\\u50CF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input\",\n          children: /*#__PURE__*/_jsxDEV(ImageUploader, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"item\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"\\u59D3\\u540D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            placeholder: \"\\u8BF7\\u8F93\\u5165\\u8D26\\u53F7\\u540D\\u79F0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(ButtonAgain, {\n        color: \"primary\",\n        className: \"submit\",\n        children: \"\\u63D0\\u4EA4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 12\n  }, this);\n};\n_s(Update, \"Z89TTAowsiu2oG8cFpX0w9rF+aQ=\");\n_c2 = Update;\nexport default connect(state => state.base, action.base)(Update);\nvar _c, _c2;\n$RefreshReg$(_c, \"UpdateBox\");\n$RefreshReg$(_c2, \"Update\");","map":{"version":3,"names":["React","useState","NavBarAgain","ButtonAgain","styled","ImageUploader","Input","Toast","connect","action","api","UpdateBox","div","Update","props","info","queryUserInfoAsync","navigate","pic","setPic","url","username","setUserName","name","limitImage","file","limit","size","show","icon","content","uploadImage","temp","code","upload","_","submit","length","trim","userUpdate","state","base"],"sources":["D:/xuexishipin/exercise/zhu-fen-exercise/react/zhihu/src/views/Update.jsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport NavBarAgain from '../components/NavBarAgain';\nimport ButtonAgain from '../components/ButtonAgain';\nimport styled from \"styled-components\";\nimport { ImageUploader, Input, Toast } from 'antd-mobile';\nimport { connect } from 'react-redux';\nimport action from '../store/action';\nimport api from '../api';\n\n/* 样式 */\nconst UpdateBox = styled.div`\n    .formBox {\n        padding: 30px;\n\n        .item {\n            display: flex;\n            align-items: center;\n            height: 110px;\n            line-height: 110px;\n            font-size: 28px;\n\n            .label {\n                width: 20%;\n                text-align: center;\n            }\n\n            .input {\n                width: 80%;\n            }\n        }\n    }\n\n    .submit {\n        display: block;\n        margin: 0 auto;\n        width: 60%;\n        height: 70px;\n        font-size: 28px;\n    }\n`;\n\nconst Update = function Update(props) {\n    let { info, queryUserInfoAsync, navigate } = props;\n    /* 定义状态 */\n    let [pic, setPic] = useState([{ url: info.pic }]),\n        [username, setUserName] = useState(info.name);\n\n    /* 图片上传 */\n    const limitImage = (file) => {\n        let limit = 1024 * 1024;\n        if (file.size > limit) {\n            Toast.show({\n                icon: 'fail',\n                content: '图片须在1MB内'\n            });\n            return null;\n        }\n        return file;\n    };\n    const uploadImage = async (file) => {\n        let temp;\n        try {\n            let { code, pic } = await api.upload(file);\n            if (+code !== 0) {\n                Toast.show({\n                    icon: 'fail',\n                    content: '上传失败'\n                });\n                return;\n            }\n            temp = pic;\n            setPic([{\n                url: pic\n            }]);\n        } catch (_) { }\n        return { url: temp };\n    };\n\n    /* 提交信息 */\n    const submit = async () => {\n        // 表单校验\n        if (pic.length === 0) {\n            Toast.show({\n                icon: 'fail',\n                content: '请先上传图片'\n            });\n            return;\n        }\n        if (username.trim() === \"\") {\n            Toast.show({\n                icon: 'fail',\n                content: '请先输入账号'\n            });\n            return;\n        }\n        // 获取信息，发送请求\n        let [{ url }] = pic;\n        try {\n            let { code } = await api.userUpdate(username.trim(), url);\n            if (+code !== 0) {\n                Toast.show({\n                    icon: 'fail',\n                    content: '修改信息失败'\n                });\n                return;\n            }\n            Toast.show({\n                icon: 'success',\n                content: '修改信息成功'\n            });\n            queryUserInfoAsync();//同步redux中的信息\n            navigate(-1);\n        } catch (_) { }\n    };\n\n    return <UpdateBox>\n        <NavBarAgain title=\"修改信息\" />\n        <div className=\"formBox\">\n            <div className=\"item\">\n                <div className=\"label\">头像</div>\n                <div className=\"input\">\n                    <ImageUploader\n                    />\n                </div>\n            </div>\n            <div className=\"item\">\n                <div className=\"label\">姓名</div>\n                <div className=\"input\">\n                    <Input placeholder='请输入账号名称' />\n                </div>\n            </div>\n            <ButtonAgain color='primary' className=\"submit\"\n                >\n                提交\n            </ButtonAgain>\n        </div>\n    </UpdateBox>;\n};\nexport default connect(\n    state => state.base,\n    action.base\n)(Update);"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self)["keepalive-react-component"]={},e.React)}(this,function(e,s){"use strict";var d="default"in s?s.default:s;function n(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach(function(e){o(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,c,o=[],a=!0,l=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){l=!0,c=e}finally{try{a||null==r.return||r.return()}finally{if(l)throw c}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=d.createContext(),u="CREATE",i="CREATED",h="ACTIVE",y="DESTROY";function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,r=t.type,n=t.payload;switch(r){case u:return c(c({},e),{},o({},n.cacheId,{scrolls:{},cacheId:n.cacheId,element:n.element,status:u}));case i:return c(c({},e),{},o({},n.cacheId,c(c({},e[n.cacheId]),{},{doms:n.doms,status:i})));case h:return c(c({},e),{},o({},n.cacheId,c(c({},e[n.cacheId]),{},{status:h})));case y:return c(c({},e),{},o({},n.cacheId,c(c({},e[n.cacheId]),{},{status:y})));default:return e}}e.KeepAliveProvider=function(e){var n=(r=a(s.useReducer(m,{}),2))[0],c=r[1],t=s.useCallback(function(e){var t=e.cacheId,r=e.element;n[t]?(e=n[t]).status===y&&(e.doms.forEach(function(e){return e.parentNode.removeChild(e)}),c({type:u,payload:{cacheId:t,element:r}})):c({type:u,payload:{cacheId:t,element:r}})},[n]),r=s.useCallback(function(e,t){t=t.target;n[e]&&(n[e].scrolls[t]=t.scrollTop)},[n]);return d.createElement(p.Provider,{value:{mount:t,cacheStates:n,dispatch:c,handleScroll:r}},e.children,Object.values(n).filter(function(e){return e.status!==y}).map(function(e){var r=e.cacheId,e=e.element;return d.createElement("div",{id:"cache_".concat(r),key:r,ref:function(e){var t=n[r];!e||t.doms&&t.status!==y||(e=Array.from(e.childNodes),c({type:i,payload:{cacheId:r,doms:e}}))}},e)}))},e.withKeepAlive=function(l,e){var t=e.cacheId,u=void 0===t?window.location.pathname:t,i=void 0!==(e=e.scroll)&&e;return function(r){var e=s.useContext(p),n=e.mount,c=e.cacheStates,o=e.dispatch,t=e.handleScroll,a=s.useRef(null);return s.useEffect(function(){i&&a.current.addEventListener("scroll",t.bind(null,u),!0)},[t]),s.useEffect(function(){var e,t=c[u];t&&t.doms&&t.status!==y?((e=t.doms).forEach(function(e){return a.current.appendChild(e)}),i&&e.forEach(function(e){t.scrolls[e]&&(e.scrollTop=t.scrolls[e])})):n({cacheId:u,element:d.createElement(l,f({},r,{dispatch:o}))})},[c,o,n,r]),d.createElement("div",{id:"keepalive_".concat(u),ref:a})}},Object.defineProperty(e,"__esModule",{value:!0})});
